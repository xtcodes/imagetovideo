<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Image → Video Converter (WebM HD)</title>
<style>
body {
  font-family: sans-serif;
  background: #f4f8fd;
  padding: 20px;
  display: flex;
  justify-content: center;
}
.app {
  width: 100%;
  max-width: 600px;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  box-sizing: border-box;
}
h2 {
  text-align: center;
  margin-bottom: 16px;
}
.file-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 16px;
  border-radius: 8px;
  background: #2563eb;
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  width: 100%;
  box-sizing: border-box;
  text-align: center;
  margin-bottom: 12px;
}
input[type="file"] {
  display: none;
}
.preview {
  width: 100%;
  position: relative;
  padding-top: 56.25%; /* 16:9 preview */
  background: #ddd;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 12px;
}
.preview img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}
.controls {
  margin-bottom: 12px;
}
.controls label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
}
.controls input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
}
button {
  padding: 12px;
  width: 100%;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  margin-top: 10px;
}
.start-btn { background: #16a34a; color: white; }
.download-btn { background: #dc2626; color: white; display: none; }
</style>
</head>
<body>
<div class="app">
  <h2>Image → Video Converter (WebM HD)</h2>

  <label class="file-btn">
    Pilih Gambar
    <input type="file" id="fileInput" accept="image/*">
  </label>

  <div class="preview placeholder" id="preview"></div>

  <div class="controls">
    <label for="duration">Durasi video (detik):</label>
    <input type="number" id="duration" value="5" min="1" max="60">
  </div>

  <button class="start-btn" id="startBtn">Buat Video</button>
  <a id="downloadBtn" class="download-btn" download="output.webm">Download Video</a>
</div>

<script>
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const startBtn = document.getElementById("startBtn");
const downloadBtn = document.getElementById("downloadBtn");
const durationInput = document.getElementById("duration");

let imageFile = null;

fileInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;
  imageFile = file;

  preview.innerHTML = "";
  const img = document.createElement("img");
  img.src = URL.createObjectURL(file);
  preview.appendChild(img);
});

startBtn.addEventListener("click", async () => {
  if (!imageFile) {
    alert("Pilih gambar dulu!");
    return;
  }

  const duration = parseInt(durationInput.value, 10) || 5; // fallback 5 detik

  const canvas = document.createElement("canvas");
  canvas.width = 1920;
  canvas.height = 1080;
  const ctx = canvas.getContext("2d");

  const img = new Image();
  img.src = URL.createObjectURL(imageFile);

  img.onload = async () => {
    const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
    const x = (canvas.width - img.width * scale) / 2;
    const y = (canvas.height - img.height * scale) / 2;

    function drawFrame() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
    }

    const stream = canvas.captureStream(30);
    const recorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp9" });

    let chunks = [];
    recorder.ondataavailable = (e) => {
      if (e.data.size > 0) chunks.push(e.data);
    };

    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: "video/webm" });
      const url = URL.createObjectURL(blob);
      downloadBtn.href = url;
      downloadBtn.style.display = "inline-block";
    };

    const interval = setInterval(drawFrame, 1000 / 30);

    recorder.start();

    setTimeout(() => {
      clearInterval(interval);
      recorder.stop();
    }, duration * 1000);
  };
});
</script>
</body>
</html>
